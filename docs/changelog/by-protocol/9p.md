# 9P (Plan 9 Filesystem Protocol) Review

**Protocol:** 9P (Plan 9 Filesystem Protocol)
**File:** `src/worker/ninep.ts`
**Reviewed:** 2026-02-18

## Summary

`docs/protocols/9P.md` was a 41-line generic protocol overview. It listed 9P message types (Tversion/Rversion, Tauth/Rauth, Tattach/Rattach, Twalk/Rwalk, etc.) with minimal descriptions, noted "Everything is a File" and "Network Transparent" design principles, and linked to Plan 9 manuals. No API endpoints, no request/response schemas, no implementation details, no known issues documented. Replaced with a 600-line power-user reference (`NINEP.md`) covering: 1. **Four API endpoints documented:**

## Bugs Found and Fixed

| # | Severity | Description |
|---|---|---|
| 1 | Medium | Fixed stat parsing offset bug (was using offset 0 instead of 2 for walked paths, causing parse failures) |
| 2 | Medium | fixed 64-bit file length arithmetic using BigInt to avoid precision loss |
| 3 | Medium | fixed timeout calculation in handshake to prevent negative values |
| 4 | Medium | added bounds validation to parse9PString and parseQID |
| 5 | Medium | added path traversal protection in buildTwalk (reject `.`, `..`, null bytes, `/`, max depth 16) |
| 6 | Medium | fixed base64 encoding to use explicit loop instead of spread operator for TS target compatibility |

## Documentation Improvements

Full protocol documentation created with endpoint references, wire format specifications, and usage examples.

## See Also

- [Protocol Specification](../../protocols/9P.md)
- [Critical Fixes Summary](../critical-fixes.md)
- [Medium Fixes Summary](../medium-fixes.md)
