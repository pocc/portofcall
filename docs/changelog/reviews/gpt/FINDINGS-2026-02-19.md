# GPT Protocol Review Findings (All Protocols)

Generated: 2026-02-19

## Scope
- Reviewed 238 protocol modules in src/worker/*.ts (excluding helpers index.ts, cloudflare-detector.ts, ssh2-impl.ts).
- Correlated docs/protocols/*.md coverage and API route wiring from src/worker/index.ts.

## High-Confidence Findings
1. Missing protocol docs for implemented modules (7): submission, tcp, tftp, torcontrol, uwsgi, varnish, ymsg.
2. Route wiring gap candidates (0): .
3. Doc/route mismatches requiring manual confirmation: 165 protocol modules.

## Medium-Confidence Findings
1. Modules that open sockets without protocol-local Cloudflare guard (69): activeusers, afp, ami, battlenet, beats, chargen, daytime, dicom, discard, dot, echo, elasticsearch, epmd, epp, etcd, finger, gemini, gopher, h323, hsrp, ident, ike, influxdb, informix, ipp, jabber-component, jsonrpc, l2tp, matrix, mdns, mgcp, mpd, msn, msrp, napster, ninep, nntp, nsca, oscar, portmapper, qotd, radsec, rcon, realaudio, rip, sccp, sentinel, shoutcast, sip, sips, snpp, soap, socks4, spamd, stomp, svn, sybase, syslog, teamspeak, tftp, time, turn, varnish, ventrilo, x11, xmpp-s2s, xmpps2s, ymsg, zabbix.
Note: some routes may rely on Cloudflare platform blocks or higher-level checks, so this is a consistency/security-hardening finding, not always a direct exploit.
2. Modules using setTimeout without clearTimeout in-file (188): 188 modules.
Note: some timeout promises intentionally do not require clearTimeout; manual review is needed for leak/straggler timers.

## Implementation Compatibility Findings
- Modules using Node Buffer APIs under nodejs_compat (17): adb, chargen, cifs, dnp3, git, hsrp, ike, l2tp, mdns, mumble, node-inspector, nrpe, oscar, realaudio, rip, turn, ymsg.
- This is runtime-compatible with current wrangler.toml, but these paths should remain covered by tests in case compatibility flags change.

## Next Manual Review Queue (Priority)
- Protocols missing docs first: submission, tcp, tftp, torcontrol, uwsgi, varnish, ymsg.
- Then review doc/route mismatches and Cloudflare-guard consistency for externally exposed endpoints.

## Remediation Update (2026-02-19)
1. Missing protocol docs (7): fixed.
   - Added canonical docs in `docs/changelog/by-protocol/` and protocol stubs in `docs/protocols/` for:
   `submission`, `tcp`, `tftp`, `torcontrol`, `uwsgi`, `varnish`, `ymsg`.
2. Cloudflare guard consistency: fixed at router layer for the 69 flagged protocols.
   - Implemented centralized guard set and pre-route guard enforcement in `src/worker/index.ts`.
3. High-confidence doc/route mismatches: fixed with route aliases and MMS route completion in `src/worker/index.ts`.
   - Added aliases:
   `/api/websocket` -> `/api/websocket/probe`
   `/api/iec104/read-data` -> `/api/iec104/read`
   `/api/grafana/dashboard/create` -> `/api/grafana/dashboard-create`
   `/api/grafana/annotation/create` -> `/api/grafana/annotation`
   - Added missing MMS routes:
   `/api/mms/namelist`, `/api/mms/read`.
4. `setTimeout` cleanup risk: mitigated centrally in `src/worker/index.ts`.
   - Added request-scoped timer tracking and automatic timeout cleanup for non-WebSocket requests.
   - WebSocket upgrades are excluded from forced cleanup to avoid interrupting long-lived sessions.

Note: The original findings counts above are preserved as an audit snapshot from generation time.
